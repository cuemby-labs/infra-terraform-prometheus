openapi: 3.0.3
info:
  title: OpenAPI schema for Prometheus template .
components:
  schemas:
    variables:
      type: object
      properties:
        release_name:
          title: Release Name
          type: string
          description: The name of the Helm release.
          default: prometheus
          x-walrus-ui:
            group: Basic
            order: 1
        namespace_name:
          title: Namespace Name
          type: string
          description: The namespace where the Helm release will be installed.
          default: prometheus-system
          x-walrus-ui:
            group: Basic
            order: 2
        chart_version:
          title: Chart Version
          type: string
          description: The version of the Prometheus Helm chart.
          default: 64.0.0
          x-walrus-ui:
            group: Basic
            order: 3
        channel_teams:
          title: Channel Teams
          type: string
          description: Channel Microsoft Teams
          default: alerts_dev-stg
          x-walrus-ui:
            group: Basic
            order: 4
        domain_name:
          title: Domain Name
          type: string
          description: Domain name for Harbor, e.g. 'dev.domainname.com'
          default: dev.domainname.com
          x-walrus-ui:
            group: Basic
            order: 5
        issuer_name:
          title: Issuer Name
          type: string
          description: Origin issuer name
          default: origin-ca-issuer
          x-walrus-ui:
            group: Basic
            order: 6
        issuer_kind:
          title: Issuer Kind
          type: string
          description: Origin issuer kind
          default: ClusterOriginIssuer
          x-walrus-ui:
            group: Basic
            order: 7
        grafana_enabled:
          title: Grafana Enabled
          type: boolean
          description: Grafana Enabled
          default: "false"
          x-walrus-ui:
            group: Basic
            order: 8
        grafana_ingress_enabled:
          title: Grafana Ingress Enabled
          type: boolean
          description: Grafana Ingress Enabled
          default: "false"
          x-walrus-ui:
            group: Basic
            order: 9
        whitelist_ips:
          title: Whitelist Ips
          type: array
          description: List of IP addresses to be whitelisted
          default:
          - 192.168.1.1
          - 192.168.1.2
          - 192.168.1.3
          items:
            type: string
          x-walrus-ui:
            colSpan: 12
            group: Basic
            order: 10
        config_secret:
          title: Config Secret
          type: string
          description: SecretConfig for MSTeams
          default: alertmanager-prometheus-kube-prometheus-alertmanager
          x-walrus-ui:
            group: Basic
            order: 11
        rules:
          title: Rules
          type: array
          description: Adding rules for AlertManager
          default:
          - alert: HostOutOfMemory
            description: |-
              Node memory is filling up (< 10% left)
                VALUE =  \{\{ $$value \}\}
                LABELS =  \{\{ $$labels \}\}
            expr: (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes * 100
              < 10) * on(instance) group_left (nodename) node_uname_info{nodename=~'.+'}
            for: 2m
            severity: warning
            summary: Host out of memory (instance  \{\{ $$labels.instance \}\})
          items:
            properties:
              alert:
                title: Alert
                type: string
                x-walrus-ui:
                  order: 1
              description:
                title: Description
                type: string
                x-walrus-ui:
                  order: 6
              expr:
                title: Expr
                type: string
                x-walrus-ui:
                  order: 2
              for:
                title: For
                type: string
                x-walrus-ui:
                  order: 3
              severity:
                title: Severity
                type: string
                x-walrus-ui:
                  order: 4
              summary:
                title: Summary
                type: string
                x-walrus-ui:
                  order: 5
            required:
            - alert
            - description
            - expr
            - for
            - severity
            - summary
            type: object
            x-walrus-ui:
              colSpan: 12
          x-walrus-ui:
            colSpan: 12
            group: Basic
            order: 12
        additional_scrape_configs:
          title: Additional Scrape Configs
          type: string
          description: YAML configuration for additional scrape configs in Prometheus
          default: |
            - job_name: 'vault'
              kubernetes_sd_configs:
                - role: endpoints
              relabel_configs:
                - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]
                  action: keep
                  regex: true
                - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name]
                  action: keep
                  regex: ccp-dev;vault
                - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]
                  action: replace
                  target_label: __metrics_path__
                  regex: (.*)
                - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_port]
                  action: replace
                  target_label: __address__
                  regex: (.*)
                  replacement: $1
            - job_name: 'node-exporter'
              static_configs:
              - targets:
                - "http://prometheus-prometheus-node-exporter:9100/metrics"
              scheme: https
              tls_config:
                insecure_skip_verify: true
          x-walrus-ui:
            group: Basic
            order: 13
            textarea: true
      x-walrus-ui:
        groupOrder:
        - Basic
